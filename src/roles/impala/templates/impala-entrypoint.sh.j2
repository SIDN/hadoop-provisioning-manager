#!/usr/bin/env bash

# Created on {{ ansible_date_time.iso8601 }}
# Pushed to: {{  inventory_hostname }}

echo "Starting Impala service: $1"

. {{ stack_root }}/apache-impala-latest/impala-daemon-env.sh

if [[ $1 -eq "impalad" ]]
then
  export JAVA_TOOL_OPTIONS="$JAVA_TOOL_OPTIONS -Xmx{{ impala_heap.impalad }}"
  {{ stack_root }}/apache-impala-latest/bin/impalad -flagfile {{ impala_etc_dir }}/impalad_flags
elif [[ $1 -eq "statestored" ]]
then
  {{ stack_root }}/apache-impala-latest/bin/statestored -flagfile {{ impala_etc_dir }}/statestored_flags
elif [[ $1 -eq "catalogd" ]]
then
  export JAVA_TOOL_OPTIONS="$JAVA_TOOL_OPTIONS -Xmx{{ impala_heap.catalogd }}"
  {{ stack_root }}/apache-impala-latest/bin/catalogd -flagfile {{ impala_etc_dir }}/catalogd_flags
fi
