- name: Copy environment
  ansible.builtin.template:
    src: 'templates/superset.env.j2'
    dest: '{{ superset_etc_dir }}/superset.env'
    owner: "{{ superset_os_user }}"
    group: "{{ superset_os_group }}"
  become: yes
  
- name: Create directories
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ superset_os_user }}"
    group: "{{ superset_os_group }}"
  loop:
    - '{{ superset_etc_dir }}/python_path'
  become: yes  

- name: Create secret key
  shell: >
      cat {{ superset_etc_dir }}/secret_key
  register: reg_secret_key
  
- set_fact:
    fact_secret_key: "{{ reg_secret_key.stdout }}"
    
- name: Copy config python script
  ansible.builtin.template:
    src: 'templates/superset_config_docker.py.j2'
    dest: '{{ superset_etc_dir }}/python_path/superset_config_docker.py'
  become: yes
  
- name: Create docker-compose script
  ansible.builtin.template:
    src: templates/docker-compose-non-dev.yml.j2
    dest: '{{ stack_root }}/apache-superset-{{ version.superset }}/docker-compose.yml'
  become: yes
