# Created on {{ ansible_date_time.iso8601 }}
# Pushed to: {{  inventory_hostname }}


AIRFLOW_PROJ_DIR={{ airflow_data_dir }}

AIRFLOW_IMAGE_NAME={{ groups['manager'][0] }}:{{ docker_registry_port }}/airflow/airflow:{{ version.airflow }}
AIRFLOW_UID={{ getent_passwd[airflow_os_user].1 }}

_AIRFLOW_WWW_USER_USERNAME={{ airflow_www_user }}
_AIRFLOW_WWW_USER_PASSWORD={{ airflow_www_password }}

AIRFLOW__DATABASE__SQL_ALCHEMY_CONN="postgresql+psycopg2://{{ airflow_db_user}}:{{ airflow_db_password }}@{{ groups['database'][0] }}/{{ airflow_db}}"
AIRFLOW__CELERY__RESULT_BACKEND="db+postgresql://{{ airflow_db_user}}:{{ airflow_db_password }}@{{ groups['database'][0] }}/{{ airflow_db}}"

AIRFLOW__WEBSERVER__BASE_URL=https://{{ inventory_hostname }}:{{ airflow_web_port }}
AIRFLOW__WEBSERVER__WEB_SERVER_POR={{ airflow_web_port }}
AIRFLOW__WEBSERVER__WEB_SERVER_SSL_CERT={{ tls_etc_dir }}/{{ tls_remote_pub_chain }}
AIRFLOW__WEBSERVER__WEB_SERVER_SSL_KEY={{ tls_etc_dir }}/{{ tls_remote_priv_key }}

AIRFLOW__CELERY__FLOWER_BASIC_AUTH={{ airflow_www_user }}:{{ airflow_www_password }}

AIRFLOW__CELERY__SSL_ACTIVE=True
AIRFLOW__CELERY__SSL_KEY={{ tls_etc_dir }}/{{ tls_remote_priv_key }}
AIRFLOW__CELERY__SSL_CERT={{ tls_etc_dir }}/{{ tls_remote_pub_chain }}

{% for key, value in airflow_additional_cfg.items() %}
AIRFLOW__{{ key| upper }}={{ value }}
{% endfor %}